---
- name: Home Server
  hosts: all
  roles:
    - role: docker
      tags: ['init']
    - role: foo
      tags: ['default']

    - role: nginx
      tags: ['default']
    - role: docker-systemd # Nginx
      tags: ['default']
      container_name: nginx
      container_repository: nginx
      container_volumes:
        - "/etc/nginx/nginx.conf:/etc/nginx/nginx.conf"
        - "/etc/nginx/conf.d:/etc/nginx/conf.d"
        - "/usr/share/nginx/html:/usr/share/nginx/html"
        - "/etc/letsencrypt:/etc/letsencrypt"
        - "/etc/ssl/dhparams.pem:/etc/ssl/dhparams.pem"
      container_extra_options:
        - "--network host"

    - role: letsencrypt
      tags: ['default']

    - role: jellyfin-setup
      tags: ['default']
    - role: docker-systemd # Jellyfin
      tags: ['default']
      container_name: jellyfin
      container_repository: jellyfin/jellyfin
      container_volumes:
        - "/media:/media"
        - "/srv/jellyfin/config:/config"
        - "/srv/jellyfin/cache:/cache"
      container_extra_options:
        - "--network host"
        - "--device /dev/dri/renderD128:/dev/dri/renderD128"
        - "--device /dev/dri/card0:/dev/dri/card0"
        - "--group-add=109"
        - "--user 1000:1000"

    - role: jupyterhub
      tags: ['default']
    - role: docker-systemd # Jupyterhub
      tags: ['default']
      container_name: jupyterhub
      # container_repository: "jupyterhub/jupyterhub jupyterhub --base-url='/jupyterhub/' --api-url='https://home.ncronquist.com/jupyterhubapi"
      container_repository: "jupyterhub/jupyterhub"
      container_cmd: jupyterhub
      container_volumes:
        - "/usr/local/share/jupyterhub:/usr/local/share/jupyterhub"
        - "/srv/jupyterhub/jupyterhub_config.py:/srv/jupyterhub/jupyterhub_config.py"
        - "/srv/jupyterhub/jupyterhub.sqlite:/srv/jupyterhub/jupyterhub.sqlite"
      container_extra_options:
        - "--network host"
